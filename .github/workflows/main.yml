# Disabled - replaced by build.yml (Nuitka)
#
# name: CI
#
# on:
#   push:
#     branches: ['**']
#     tags: ['v*']
#   pull_request:
#
# jobs:
#   build-linux:
#     runs-on: ubuntu-22.04
#
#     steps:
#     - uses: actions/checkout@v4
#
#     - name: Build
#       run: ./util/linux-builder/build-in-docker.sh
#
#     - uses: actions/upload-artifact@v4
#       with:
#         name: vial-linux
#         path: util/linux-builder/output/Vial-x86_64.AppImage
#
#   build-mac:
#     runs-on: macos-15-intel
#
#     steps:
#     - uses: actions/checkout@v4
#
#     - uses: actions/setup-python@v5
#       with:
#         python-version: '3.6'
#
#     - name: Setup venv
#       run: |
#         python3 -m venv venv
#         source venv/bin/activate
#         pip install --upgrade pip
#         pip install -r requirements.txt
#
#     - name: Build
#       run: |
#         source venv/bin/activate
#         fbs freeze
#         hdiutil create -volname Vial -srcfolder "target/Vial.app" -ov -format UDZO vial-mac.dmg
#
#     - uses: actions/upload-artifact@v4
#       with:
#         name: vial-mac
#         path: vial-mac.dmg
#
#   build-win:
#     runs-on: windows-2025
#
#     steps:
#     - uses: actions/checkout@v4
#     - uses: actions/setup-python@v5
#       with:
#         python-version: '3.6'
#
#     - name: Setup venv
#       run: |
#         python -m venv venv
#         . .\venv\Scripts\activate.ps1
#         python -m pip install --upgrade pip
#         pip install -r requirements.txt
#
#     - name: Install NSIS
#       run: |
#         Invoke-WebRequest "https://github.com/vial-kb/vial-deps/releases/download/v1/nsis-3.06.1-setup.exe" -UserAgent "wget" -OutFile nsis-3.06.1-setup.exe
#         if ((Get-FileHash nsis-3.06.1-setup.exe -Algorithm sha256).Hash -ne "f60488a676308079bfdf6845dc7114cfd4bbff47b66be4db827b89bb8d7fdc52") { Write-Error 'SHA256 mismatch' }
#         Start-Process -FilePath "nsis-3.06.1-setup.exe" -ArgumentList "/S", "/D=C:\Program Files (x86)\NSIS" -NoNewWindow -Wait
#
#     - name: Install Visual C++ Redistributable
#       run: |
#         Invoke-WebRequest -Uri "https://download.microsoft.com/download/3/2/2/3224B87F-CFA0-4E70-BDA3-3DE650EFEBA5/vcredist_x64.exe" -OutFile "vcredist_x64.exe"
#         Start-Process -FilePath "vcredist_x64.exe" -ArgumentList "/install", "/quiet", "/norestart" -Wait
#         Remove-Item "vcredist_x64.exe"
#
#     - name: Build
#       run: |
#         . .\venv\Scripts\activate.ps1
#         fbs freeze
#         Compress-Archive -Path "target\Vial" -DestinationPath vial-win.zip
#
#     - uses: actions/upload-artifact@v4
#       with:
#         name: vial-win
#         path: vial-win.zip
#
#     - name: Create installer
#       run: |
#         $env:Path += ";C:\Program Files (x86)\NSIS"
#         . .\venv\Scripts\activate.ps1
#         fbs installer
#
#     - uses: actions/upload-artifact@v4
#       with:
#         name: vial-win-installer
#         path: target\VialSetup.exe
#
#   build-web:
#     runs-on: ubuntu-22.04
#
#     container:
#       image: ghcr.io/ilc/vial-gui-build:latest
#
#     steps:
#     - uses: actions/checkout@v4
#
#     - name: Add safe directory
#       run: git config --global --add safe.directory "$GITHUB_WORKSPACE"
#
#     - name: Build
#       run: |
#         cd web
#         ./build.sh
#
#     - uses: actions/upload-artifact@v4
#       with:
#         name: vial-web
#         path: web/build
#
#     - uses: actions/upload-pages-artifact@v3
#       with:
#         path: web/build
#
#   deploy-web:
#     if: github.ref == 'refs/heads/sval-gui'
#     needs: build-web
#     runs-on: ubuntu-22.04
#     permissions:
#       pages: write
#       id-token: write
#     environment:
#       name: github-pages
#       url: ${{ steps.deploy.outputs.page_url }}
#
#     steps:
#     - name: Deploy to GitHub Pages
#       id: deploy
#       uses: actions/deploy-pages@v4
#
#   release:
#     if: startsWith(github.ref, 'refs/tags/v')
#     needs: [build-linux, build-mac, build-win, build-web]
#     runs-on: ubuntu-22.04
#     permissions:
#       contents: write
#
#     steps:
#     - uses: actions/download-artifact@v4
#       with:
#         path: artifacts
#
#     - name: Prepare release assets
#       run: |
#         cd artifacts
#         mv vial-linux/Vial-x86_64.AppImage ./Vial-${{ github.ref_name }}-linux.AppImage
#         mv vial-mac/vial-mac.dmg ./Vial-${{ github.ref_name }}-mac.dmg
#         mv vial-win/vial-win.zip ./Vial-${{ github.ref_name }}-win.zip
#         mv vial-win-installer/VialSetup.exe ./Vial-${{ github.ref_name }}-win-installer.exe
#         zip -r Vial-${{ github.ref_name }}-web.zip vial-web/
#         rm -rf vial-linux vial-mac vial-win vial-win-installer vial-web github-pages
#
#     - uses: softprops/action-gh-release@v2
#       with:
#         files: artifacts/*
#         generate_release_notes: true
